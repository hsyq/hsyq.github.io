(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{333:function(e,t,a){"use strict";a.r(t);var o=a(13),n=Object(o.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"经典crud"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#经典crud"}},[e._v("#")]),e._v(" 经典CRUD")]),e._v(" "),t("h2",{attrs:{id:"查询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查询"}},[e._v("#")]),e._v(" 查询")]),e._v(" "),t("h3",{attrs:{id:"api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#api"}},[e._v("#")]),e._v(" API")]),e._v(" "),t("ul",[t("li",[t("p",[t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#model_Model.find",target:"_blank",rel:"noopener noreferrer"}},[e._v("Model.find()"),t("OutboundLink")],1)])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#model_Model.findById",target:"_blank",rel:"noopener noreferrer"}},[e._v("Model.findById()"),t("OutboundLink")],1)])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#model_Model.findByIdAndDelete",target:"_blank",rel:"noopener noreferrer"}},[e._v("Model.findByIdAndDelete()"),t("OutboundLink")],1)])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#model_Model.findByIdAndRemove",target:"_blank",rel:"noopener noreferrer"}},[e._v("Model.findByIdAndRemove()"),t("OutboundLink")],1)])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#model_Model.findByIdAndUpdate",target:"_blank",rel:"noopener noreferrer"}},[e._v("Model.findByIdAndUpdate()"),t("OutboundLink")],1)])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#model_Model.findOne",target:"_blank",rel:"noopener noreferrer"}},[e._v("Model.findOne()"),t("OutboundLink")],1)])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#model_Model.findOneAndDelete",target:"_blank",rel:"noopener noreferrer"}},[e._v("Model.findOneAndDelete()"),t("OutboundLink")],1)])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#model_Model.findOneAndRemove",target:"_blank",rel:"noopener noreferrer"}},[e._v("Model.findOneAndRemove()"),t("OutboundLink")],1)])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#model_Model.findOneAndReplace",target:"_blank",rel:"noopener noreferrer"}},[e._v("Model.findOneAndReplace()"),t("OutboundLink")],1)])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#model_Model.findOneAndUpdate",target:"_blank",rel:"noopener noreferrer"}},[e._v("Model.findOneAndUpdate()"),t("OutboundLink")],1)])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#model_Model.hydrate",target:"_blank",rel:"noopener noreferrer"}},[e._v("Model.hydrate()"),t("OutboundLink")],1)])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#model_Model.populate",target:"_blank",rel:"noopener noreferrer"}},[e._v("Model.populate()"),t("OutboundLink")],1)])])]),e._v(" "),t("h3",{attrs:{id:"model-findbyidandupdate"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#model-findbyidandupdate"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#model_Model.findByIdAndUpdate",target:"_blank",rel:"noopener noreferrer"}},[e._v("Model.findByIdAndUpdate()"),t("OutboundLink")],1)]),e._v(" "),t("h5",{attrs:{id:"parameters"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#parameters"}},[e._v("#")]),e._v(" Parameters")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("id")]),e._v(" "),t("p",[e._v("«Object|Number|String»")]),e._v(" "),t("p",[e._v("value of")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("_id\n")])])]),t("p",[e._v("to query by")])]),e._v(" "),t("li",[t("p",[e._v("[update] «Object»")])]),e._v(" "),t("li",[t("p",[e._v("[options]")]),e._v(" "),t("p",[e._v("«Object»")]),e._v(" "),t("p",[e._v("optional see")]),e._v(" "),t("p",[t("code",[e._v("Query.prototype.setOptions()")])])]),e._v(" "),t("li",[t("ul",[t("li",[t("p",[e._v("[options.returnDocument='before']")]),e._v(" "),t("p",[e._v("«String»")]),e._v(" "),t("p",[e._v("Has two possible values,")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("'before'\n")])])]),t("p",[e._v("and")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("'after'\n")])])]),t("p",[e._v(". By default, it will return the document before the update was applied.")])])])]),e._v(" "),t("li",[t("ul",[t("li",[t("p",[e._v("[options.lean]")]),e._v(" "),t("p",[e._v("«Object»")]),e._v(" "),t("p",[e._v("if truthy, mongoose will return the document as a plain JavaScript object rather than a mongoose document. See")]),e._v(" "),t("p",[t("code",[e._v("Query.lean()")])]),e._v(" "),t("p",[e._v("and")]),e._v(" "),t("p",[e._v("the Mongoose lean tutorial")]),e._v(" "),t("p",[e._v(".")])])])]),e._v(" "),t("li",[t("ul",[t("li",[t("p",[e._v("[options.session=null]")]),e._v(" "),t("p",[e._v("«ClientSession»")]),e._v(" "),t("p",[e._v("The session associated with this query. See")]),e._v(" "),t("p",[e._v("transactions docs")]),e._v(" "),t("p",[e._v(".")])])])]),e._v(" "),t("li",[t("ul",[t("li",[t("p",[e._v("[options.strict]")]),e._v(" "),t("p",[e._v("«Boolean|String»")]),e._v(" "),t("p",[e._v("overwrites the schema's")]),e._v(" "),t("p",[e._v("strict mode option")])])])]),e._v(" "),t("li",[t("ul",[t("li",[t("p",[e._v("[options.timestamps=null]")]),e._v(" "),t("p",[e._v("«Boolean»")]),e._v(" "),t("p",[e._v("If set to")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("false\n")])])]),t("p",[e._v("and")]),e._v(" "),t("p",[e._v("schema-level timestamps")]),e._v(" "),t("p",[e._v("are enabled, skip timestamps for this update. Note that this allows you to overwrite timestamps. Does nothing if schema-level timestamps are not set.")])])])]),e._v(" "),t("li",[t("ul",[t("li",[t("p",[e._v("[options.overwrite=false]")]),e._v(" "),t("p",[e._v("«Boolean»")]),e._v(" "),t("p",[e._v("By default, if you don't include any")]),e._v(" "),t("p",[e._v("update operators")]),e._v(" "),t("p",[e._v("in")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("update\n")])])]),t("p",[e._v(", Mongoose will wrap")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("update\n")])])]),t("p",[e._v("in")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("$set\n")])])]),t("p",[e._v("for you. This prevents you from accidentally overwriting the document. This option tells Mongoose to skip adding")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("$set\n")])])]),t("p",[e._v(". An alternative to this would be using")]),e._v(" "),t("p",[e._v("Model.findOneAndReplace({ _id: id }, update, options, callback)")]),e._v(" "),t("p",[e._v(".")])])])]),e._v(" "),t("li",[t("p",[e._v("[callback] «Function»")])])]),e._v(" "),t("h5",{attrs:{id:"returns"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#returns"}},[e._v("#")]),e._v(" Returns:")]),e._v(" "),t("ul",[t("li",[e._v("«Query»")])]),e._v(" "),t("p",[e._v("通过文档的 _id 字段，发起一个mongodb的查询更新命令。 "),t("code",[e._v("findByIdAndUpdate(id, ...)")]),e._v(" 等同于 "),t("code",[e._v("findOneAndUpdate({ _id: id }, ...)")]),e._v("。")]),e._v(" "),t("p",[e._v("Issues a mongodb findAndModify update command by a document's _id field. "),t("code",[e._v("findByIdAndUpdate(id, ...)")]),e._v(" is equivalent to "),t("code",[e._v("findOneAndUpdate({ _id: id }, ...)")]),e._v(".")]),e._v(" "),t("p",[e._v("Finds a matching document, updates it according to the "),t("code",[e._v("update")]),e._v(" arg, passing any "),t("code",[e._v("options")]),e._v(", and returns the found document (if any) to the callback. The query executes if "),t("code",[e._v("callback")]),e._v(" is passed.")]),e._v(" "),t("p",[e._v("This function triggers the following middleware.")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("findOneAndUpdate()")])])]),e._v(" "),t("h4",{attrs:{id:"options"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#options"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#options",target:"_blank",rel:"noopener noreferrer"}},[e._v("Options:"),t("OutboundLink")],1)]),e._v(" "),t("ul",[t("li",[t("code",[e._v("new")]),e._v(": bool - true to return the modified document rather than the original. defaults to false")]),e._v(" "),t("li",[t("code",[e._v("upsert")]),e._v(": bool - creates the object if it doesn't exist. defaults to false.")]),e._v(" "),t("li",[t("code",[e._v("runValidators")]),e._v(": if true, runs "),t("a",{attrs:{href:"https://mongoosejs.com/docs/validation.html#update-validators",target:"_blank",rel:"noopener noreferrer"}},[e._v("update validators"),t("OutboundLink")],1),e._v(" on this command. Update validators validate the update operation against the model's schema.")]),e._v(" "),t("li",[t("code",[e._v("setDefaultsOnInsert")]),e._v(": "),t("code",[e._v("true")]),e._v(" by default. If "),t("code",[e._v("setDefaultsOnInsert")]),e._v(" and "),t("code",[e._v("upsert")]),e._v(" are true, mongoose will apply the "),t("a",{attrs:{href:"https://mongoosejs.com/docs/defaults.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("defaults"),t("OutboundLink")],1),e._v(" specified in the model's schema if a new document is created.")]),e._v(" "),t("li",[t("code",[e._v("sort")]),e._v(": if multiple docs are found by the conditions, sets the sort order to choose which doc to update")]),e._v(" "),t("li",[t("code",[e._v("select")]),e._v(": sets the document fields to return")]),e._v(" "),t("li",[t("code",[e._v("rawResult")]),e._v(": if true, returns the "),t("a",{attrs:{href:"https://mongodb.github.io/node-mongodb-native/4.3/interfaces/ModifyResult.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("raw result from the MongoDB driver"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("code",[e._v("strict")]),e._v(": overwrites the schema's "),t("a",{attrs:{href:"https://mongoosejs.com/docs/guide.html#strict",target:"_blank",rel:"noopener noreferrer"}},[e._v("strict mode option"),t("OutboundLink")],1),e._v(" for this update")])]),e._v(" "),t("h4",{attrs:{id:"examples"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#examples"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#examples",target:"_blank",rel:"noopener noreferrer"}},[e._v("Examples:"),t("OutboundLink")],1)]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("A.findByIdAndUpdate(id, update, options, callback) // executes\nA.findByIdAndUpdate(id, update, options)  // returns Query\nA.findByIdAndUpdate(id, update, callback) // executes\nA.findByIdAndUpdate(id, update)           // returns Query\nA.findByIdAndUpdate()                     // returns Query\n")])])]),t("h4",{attrs:{id:"note"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#note"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#note",target:"_blank",rel:"noopener noreferrer"}},[e._v("Note:"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("All top level update keys which are not "),t("code",[e._v("atomic")]),e._v(" operation names are treated as set operations:")]),e._v(" "),t("h4",{attrs:{id:"example"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#example"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#example",target:"_blank",rel:"noopener noreferrer"}},[e._v("Example:"),t("OutboundLink")],1)]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Model.findByIdAndUpdate(id, { name: 'jason bourne' }, options, callback)\n\n// is sent as\nModel.findByIdAndUpdate(id, { $set: { name: 'jason bourne' }}, options, callback)\n")])])]),t("p",[e._v("This helps prevent accidentally overwriting your document with "),t("code",[e._v("{ name: 'jason bourne' }")]),e._v(".")]),e._v(" "),t("h4",{attrs:{id:"note-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#note-2"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#note-1",target:"_blank",rel:"noopener noreferrer"}},[e._v("Note:"),t("OutboundLink")],1)]),e._v(" "),t("p",[t("code",[e._v("findOneAndX")]),e._v(" and "),t("code",[e._v("findByIdAndX")]),e._v(" functions support limited validation. You can enable validation by setting the "),t("code",[e._v("runValidators")]),e._v(" option.")]),e._v(" "),t("p",[e._v("If you need full-fledged validation, use the traditional approach of first retrieving the document.")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Model.findById(id, function (err, doc) {\n  if (err) ..\n  doc.name = 'jason bourne';\n  doc.save(callback);\n});\n")])])]),t("hr"),e._v(" "),t("h3",{attrs:{id:"model-findone"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#model-findone"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#model_Model.findOne",target:"_blank",rel:"noopener noreferrer"}},[e._v("Model.findOne()"),t("OutboundLink")],1)]),e._v(" "),t("h5",{attrs:{id:"parameters-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#parameters-2"}},[e._v("#")]),e._v(" Parameters")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("[conditions] «Object»")])]),e._v(" "),t("li",[t("p",[e._v("[projection]")]),e._v(" "),t("p",[e._v("«Object|String|Array"),t("String",[e._v("»")])],1),e._v(" "),t("p",[e._v("optional fields to return, see")]),e._v(" "),t("p",[t("code",[e._v("Query.prototype.select()")])])]),e._v(" "),t("li",[t("p",[e._v("[options]")]),e._v(" "),t("p",[e._v("«Object»")]),e._v(" "),t("p",[e._v("optional see")]),e._v(" "),t("p",[t("code",[e._v("Query.prototype.setOptions()")])])]),e._v(" "),t("li",[t("p",[e._v("[callback] «Function»")])])]),e._v(" "),t("h5",{attrs:{id:"returns-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#returns-2"}},[e._v("#")]),e._v(" Returns:")]),e._v(" "),t("ul",[t("li",[e._v("«Query»")])]),e._v(" "),t("p",[e._v("Finds one document.")]),e._v(" "),t("p",[e._v("The "),t("code",[e._v("conditions")]),e._v(" are cast to their respective SchemaTypes before the command is sent.")]),e._v(" "),t("p",[t("em",[e._v("Note:")]),e._v(" "),t("code",[e._v("conditions")]),e._v(" is optional, and if "),t("code",[e._v("conditions")]),e._v(" is null or undefined, mongoose will send an empty "),t("code",[e._v("findOne")]),e._v(" command to MongoDB, which will return an arbitrary document. If you're querying by "),t("code",[e._v("_id")]),e._v(", use "),t("code",[e._v("findById()")]),e._v(" instead.")]),e._v(" "),t("h4",{attrs:{id:"example-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#example-2"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#example",target:"_blank",rel:"noopener noreferrer"}},[e._v("Example:"),t("OutboundLink")],1)]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("// Find one adventure whose `country` is 'Croatia', otherwise `null`\nawait Adventure.findOne({ country: 'Croatia' }).exec();\n\n// using callback\nAdventure.findOne({ country: 'Croatia' }, function (err, adventure) {});\n\n// select only the adventures name and length\nawait Adventure.findOne({ country: 'Croatia' }, 'name length').exec();\n")])])]),t("hr"),e._v(" "),t("h3",{attrs:{id:"model-findoneanddelete"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#model-findoneanddelete"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#model_Model.findOneAndDelete",target:"_blank",rel:"noopener noreferrer"}},[e._v("Model.findOneAndDelete()"),t("OutboundLink")],1)]),e._v(" "),t("h5",{attrs:{id:"parameters-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#parameters-3"}},[e._v("#")]),e._v(" Parameters")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("conditions «Object»")])]),e._v(" "),t("li",[t("p",[e._v("[options]")]),e._v(" "),t("p",[e._v("«Object»")]),e._v(" "),t("p",[e._v("optional see")]),e._v(" "),t("p",[t("code",[e._v("Query.prototype.setOptions()")])])]),e._v(" "),t("li",[t("ul",[t("li",[t("p",[e._v("[options.strict]")]),e._v(" "),t("p",[e._v("«Boolean|String»")]),e._v(" "),t("p",[e._v("overwrites the schema's")]),e._v(" "),t("p",[e._v("strict mode option")])])])]),e._v(" "),t("li",[t("ul",[t("li",[t("p",[e._v("[options.projection=null]")]),e._v(" "),t("p",[e._v("«Object|String|Array"),t("String",[e._v("»")])],1),e._v(" "),t("p",[e._v("optional fields to return, see")]),e._v(" "),t("p",[t("code",[e._v("Query.prototype.select()")])])])])]),e._v(" "),t("li",[t("ul",[t("li",[t("p",[e._v("[options.session=null]")]),e._v(" "),t("p",[e._v("«ClientSession»")]),e._v(" "),t("p",[e._v("The session associated with this query. See")]),e._v(" "),t("p",[e._v("transactions docs")]),e._v(" "),t("p",[e._v(".")])])])]),e._v(" "),t("li",[t("p",[e._v("[callback] «Function»")])])]),e._v(" "),t("h5",{attrs:{id:"returns-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#returns-3"}},[e._v("#")]),e._v(" Returns:")]),e._v(" "),t("ul",[t("li",[e._v("«Query»")])]),e._v(" "),t("p",[e._v("Issue a MongoDB "),t("code",[e._v("findOneAndDelete()")]),e._v(" command.")]),e._v(" "),t("p",[e._v("Finds a matching document, removes it, and passes the found document (if any) to the callback.")]),e._v(" "),t("p",[e._v("Executes the query if "),t("code",[e._v("callback")]),e._v(" is passed.")]),e._v(" "),t("p",[e._v("This function triggers the following middleware.")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("findOneAndDelete()")])])]),e._v(" "),t("p",[e._v("This function differs slightly from "),t("code",[e._v("Model.findOneAndRemove()")]),e._v(" in that "),t("code",[e._v("findOneAndRemove()")]),e._v(" becomes a "),t("a",{attrs:{href:"https://docs.mongodb.com/manual/reference/method/db.collection.findAndModify/",target:"_blank",rel:"noopener noreferrer"}},[e._v("MongoDB "),t("code",[e._v("findAndModify()")]),e._v(" command"),t("OutboundLink")],1),e._v(", as opposed to a "),t("code",[e._v("findOneAndDelete()")]),e._v(" command. For most mongoose use cases, this distinction is purely pedantic. You should use "),t("code",[e._v("findOneAndDelete()")]),e._v(" unless you have a good reason not to.")]),e._v(" "),t("h4",{attrs:{id:"options-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#options-2"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#options",target:"_blank",rel:"noopener noreferrer"}},[e._v("Options:"),t("OutboundLink")],1)]),e._v(" "),t("ul",[t("li",[t("code",[e._v("sort")]),e._v(": if multiple docs are found by the conditions, sets the sort order to choose which doc to update")]),e._v(" "),t("li",[t("code",[e._v("maxTimeMS")]),e._v(": puts a time limit on the query - requires mongodb >= 2.6.0")]),e._v(" "),t("li",[t("code",[e._v("select")]),e._v(": sets the document fields to return, ex. "),t("code",[e._v("{ projection: { _id: 0 } }")])]),e._v(" "),t("li",[t("code",[e._v("projection")]),e._v(": equivalent to "),t("code",[e._v("select")])]),e._v(" "),t("li",[t("code",[e._v("rawResult")]),e._v(": if true, returns the "),t("a",{attrs:{href:"https://mongodb.github.io/node-mongodb-native/4.3/interfaces/ModifyResult.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("raw result from the MongoDB driver"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("code",[e._v("strict")]),e._v(": overwrites the schema's "),t("a",{attrs:{href:"https://mongoosejs.com/docs/guide.html#strict",target:"_blank",rel:"noopener noreferrer"}},[e._v("strict mode option"),t("OutboundLink")],1),e._v(" for this update")])]),e._v(" "),t("h4",{attrs:{id:"examples-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#examples-2"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#examples",target:"_blank",rel:"noopener noreferrer"}},[e._v("Examples:"),t("OutboundLink")],1)]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("A.findOneAndDelete(conditions, options, callback) // executes\nA.findOneAndDelete(conditions, options)  // return Query\nA.findOneAndDelete(conditions, callback) // executes\nA.findOneAndDelete(conditions) // returns Query\nA.findOneAndDelete()           // returns Query\n")])])]),t("p",[t("code",[e._v("findOneAndX")]),e._v(" and "),t("code",[e._v("findByIdAndX")]),e._v(" functions support limited validation. You can enable validation by setting the "),t("code",[e._v("runValidators")]),e._v(" option.")]),e._v(" "),t("p",[e._v("If you need full-fledged validation, use the traditional approach of first retrieving the document.")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Model.findById(id, function (err, doc) {\n  if (err) ..\n  doc.name = 'jason bourne';\n  doc.save(callback);\n});\n")])])]),t("hr"),e._v(" "),t("h3",{attrs:{id:"model-findoneandremove"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#model-findoneandremove"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#model_Model.findOneAndRemove",target:"_blank",rel:"noopener noreferrer"}},[e._v("Model.findOneAndRemove()"),t("OutboundLink")],1)]),e._v(" "),t("h5",{attrs:{id:"parameters-4"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#parameters-4"}},[e._v("#")]),e._v(" Parameters")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("conditions «Object»")])]),e._v(" "),t("li",[t("p",[e._v("[options]")]),e._v(" "),t("p",[e._v("«Object»")]),e._v(" "),t("p",[e._v("optional see")]),e._v(" "),t("p",[t("code",[e._v("Query.prototype.setOptions()")])])]),e._v(" "),t("li",[t("ul",[t("li",[t("p",[e._v("[options.session=null]")]),e._v(" "),t("p",[e._v("«ClientSession»")]),e._v(" "),t("p",[e._v("The session associated with this query. See")]),e._v(" "),t("p",[e._v("transactions docs")]),e._v(" "),t("p",[e._v(".")])])])]),e._v(" "),t("li",[t("ul",[t("li",[t("p",[e._v("[options.strict]")]),e._v(" "),t("p",[e._v("«Boolean|String»")]),e._v(" "),t("p",[e._v("overwrites the schema's")]),e._v(" "),t("p",[e._v("strict mode option")])])])]),e._v(" "),t("li",[t("ul",[t("li",[t("p",[e._v("[options.projection=null]")]),e._v(" "),t("p",[e._v("«Object|String|Array"),t("String",[e._v("»")])],1),e._v(" "),t("p",[e._v("optional fields to return, see")]),e._v(" "),t("p",[t("code",[e._v("Query.prototype.select()")])])])])]),e._v(" "),t("li",[t("p",[e._v("[callback] «Function»")])])]),e._v(" "),t("h5",{attrs:{id:"returns-4"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#returns-4"}},[e._v("#")]),e._v(" Returns:")]),e._v(" "),t("ul",[t("li",[e._v("«Query»")])]),e._v(" "),t("p",[e._v("Issue a mongodb findAndModify remove command.")]),e._v(" "),t("p",[e._v("Finds a matching document, removes it, passing the found document (if any) to the callback.")]),e._v(" "),t("p",[e._v("Executes the query if "),t("code",[e._v("callback")]),e._v(" is passed.")]),e._v(" "),t("p",[e._v("This function triggers the following middleware.")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("findOneAndRemove()")])])]),e._v(" "),t("h4",{attrs:{id:"options-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#options-3"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#options",target:"_blank",rel:"noopener noreferrer"}},[e._v("Options:"),t("OutboundLink")],1)]),e._v(" "),t("ul",[t("li",[t("code",[e._v("sort")]),e._v(": if multiple docs are found by the conditions, sets the sort order to choose which doc to update")]),e._v(" "),t("li",[t("code",[e._v("maxTimeMS")]),e._v(": puts a time limit on the query - requires mongodb >= 2.6.0")]),e._v(" "),t("li",[t("code",[e._v("select")]),e._v(": sets the document fields to return")]),e._v(" "),t("li",[t("code",[e._v("projection")]),e._v(": like select, it determines which fields to return, ex. "),t("code",[e._v("{ projection: { _id: 0 } }")])]),e._v(" "),t("li",[t("code",[e._v("rawResult")]),e._v(": if true, returns the "),t("a",{attrs:{href:"https://mongodb.github.io/node-mongodb-native/4.3/interfaces/ModifyResult.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("raw result from the MongoDB driver"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("code",[e._v("strict")]),e._v(": overwrites the schema's "),t("a",{attrs:{href:"https://mongoosejs.com/docs/guide.html#strict",target:"_blank",rel:"noopener noreferrer"}},[e._v("strict mode option"),t("OutboundLink")],1),e._v(" for this update")])]),e._v(" "),t("h4",{attrs:{id:"examples-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#examples-3"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#examples",target:"_blank",rel:"noopener noreferrer"}},[e._v("Examples:"),t("OutboundLink")],1)]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("A.findOneAndRemove(conditions, options, callback) // executes\nA.findOneAndRemove(conditions, options)  // return Query\nA.findOneAndRemove(conditions, callback) // executes\nA.findOneAndRemove(conditions) // returns Query\nA.findOneAndRemove()           // returns Query\n")])])]),t("p",[t("code",[e._v("findOneAndX")]),e._v(" and "),t("code",[e._v("findByIdAndX")]),e._v(" functions support limited validation. You can enable validation by setting the "),t("code",[e._v("runValidators")]),e._v(" option.")]),e._v(" "),t("p",[e._v("If you need full-fledged validation, use the traditional approach of first retrieving the document.")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Model.findById(id, function (err, doc) {\n  if (err) ..\n  doc.name = 'jason bourne';\n  doc.save(callback);\n});\n")])])]),t("hr"),e._v(" "),t("h3",{attrs:{id:"model-findoneandreplace"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#model-findoneandreplace"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#model_Model.findOneAndReplace",target:"_blank",rel:"noopener noreferrer"}},[e._v("Model.findOneAndReplace()"),t("OutboundLink")],1)]),e._v(" "),t("h5",{attrs:{id:"parameters-5"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#parameters-5"}},[e._v("#")]),e._v(" Parameters")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("filter")]),e._v(" "),t("p",[e._v("«Object»")]),e._v(" "),t("p",[e._v("Replace the first document that matches this filter")])]),e._v(" "),t("li",[t("p",[e._v("[replacement]")]),e._v(" "),t("p",[e._v("«Object»")]),e._v(" "),t("p",[e._v("Replace with this document")])]),e._v(" "),t("li",[t("p",[e._v("[options]")]),e._v(" "),t("p",[e._v("«Object»")]),e._v(" "),t("p",[e._v("optional see")]),e._v(" "),t("p",[t("code",[e._v("Query.prototype.setOptions()")])])]),e._v(" "),t("li",[t("ul",[t("li",[t("p",[e._v("[options.returnDocument='before']")]),e._v(" "),t("p",[e._v("«String»")]),e._v(" "),t("p",[e._v("Has two possible values,")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("'before'\n")])])]),t("p",[e._v("and")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("'after'\n")])])]),t("p",[e._v(". By default, it will return the document before the update was applied.")])])])]),e._v(" "),t("li",[t("ul",[t("li",[t("p",[e._v("[options.lean]")]),e._v(" "),t("p",[e._v("«Object»")]),e._v(" "),t("p",[e._v("if truthy, mongoose will return the document as a plain JavaScript object rather than a mongoose document. See")]),e._v(" "),t("p",[t("code",[e._v("Query.lean()")])]),e._v(" "),t("p",[e._v("and")]),e._v(" "),t("p",[e._v("the Mongoose lean tutorial")]),e._v(" "),t("p",[e._v(".")])])])]),e._v(" "),t("li",[t("ul",[t("li",[t("p",[e._v("[options.session=null]")]),e._v(" "),t("p",[e._v("«ClientSession»")]),e._v(" "),t("p",[e._v("The session associated with this query. See")]),e._v(" "),t("p",[e._v("transactions docs")]),e._v(" "),t("p",[e._v(".")])])])]),e._v(" "),t("li",[t("ul",[t("li",[t("p",[e._v("[options.strict]")]),e._v(" "),t("p",[e._v("«Boolean|String»")]),e._v(" "),t("p",[e._v("overwrites the schema's")]),e._v(" "),t("p",[e._v("strict mode option")])])])]),e._v(" "),t("li",[t("ul",[t("li",[t("p",[e._v("[options.timestamps=null]")]),e._v(" "),t("p",[e._v("«Boolean»")]),e._v(" "),t("p",[e._v("If set to")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("false\n")])])]),t("p",[e._v("and")]),e._v(" "),t("p",[e._v("schema-level timestamps")]),e._v(" "),t("p",[e._v("are enabled, skip timestamps for this update. Note that this allows you to overwrite timestamps. Does nothing if schema-level timestamps are not set.")])])])]),e._v(" "),t("li",[t("ul",[t("li",[t("p",[e._v("[options.projection=null]")]),e._v(" "),t("p",[e._v("«Object|String|Array"),t("String",[e._v("»")])],1),e._v(" "),t("p",[e._v("optional fields to return, see")]),e._v(" "),t("p",[t("code",[e._v("Query.prototype.select()")])])])])]),e._v(" "),t("li",[t("p",[e._v("[callback] «Function»")])])]),e._v(" "),t("h5",{attrs:{id:"returns-5"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#returns-5"}},[e._v("#")]),e._v(" Returns:")]),e._v(" "),t("ul",[t("li",[e._v("«Query»")])]),e._v(" "),t("p",[e._v("Issue a MongoDB "),t("code",[e._v("findOneAndReplace()")]),e._v(" command.")]),e._v(" "),t("p",[e._v("Finds a matching document, replaces it with the provided doc, and passes the returned doc to the callback.")]),e._v(" "),t("p",[e._v("Executes the query if "),t("code",[e._v("callback")]),e._v(" is passed.")]),e._v(" "),t("p",[e._v("This function triggers the following query middleware.")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("findOneAndReplace()")])])]),e._v(" "),t("h4",{attrs:{id:"options-4"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#options-4"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#options",target:"_blank",rel:"noopener noreferrer"}},[e._v("Options:"),t("OutboundLink")],1)]),e._v(" "),t("ul",[t("li",[t("code",[e._v("sort")]),e._v(": if multiple docs are found by the conditions, sets the sort order to choose which doc to update")]),e._v(" "),t("li",[t("code",[e._v("maxTimeMS")]),e._v(": puts a time limit on the query - requires mongodb >= 2.6.0")]),e._v(" "),t("li",[t("code",[e._v("select")]),e._v(": sets the document fields to return")]),e._v(" "),t("li",[t("code",[e._v("projection")]),e._v(": like select, it determines which fields to return, ex. "),t("code",[e._v("{ projection: { _id: 0 } }")])]),e._v(" "),t("li",[t("code",[e._v("rawResult")]),e._v(": if true, returns the "),t("a",{attrs:{href:"https://mongodb.github.io/node-mongodb-native/4.3/interfaces/ModifyResult.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("raw result from the MongoDB driver"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("code",[e._v("strict")]),e._v(": overwrites the schema's "),t("a",{attrs:{href:"https://mongoosejs.com/docs/guide.html#strict",target:"_blank",rel:"noopener noreferrer"}},[e._v("strict mode option"),t("OutboundLink")],1),e._v(" for this update")])]),e._v(" "),t("h4",{attrs:{id:"examples-4"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#examples-4"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#examples",target:"_blank",rel:"noopener noreferrer"}},[e._v("Examples:"),t("OutboundLink")],1)]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("A.findOneAndReplace(filter, replacement, options, callback) // executes\nA.findOneAndReplace(filter, replacement, options)  // return Query\nA.findOneAndReplace(filter, replacement, callback) // executes\nA.findOneAndReplace(filter, replacement) // returns Query\nA.findOneAndReplace()                    // returns Query\n")])])]),t("hr"),e._v(" "),t("h3",{attrs:{id:"model-findoneandupdate"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#model-findoneandupdate"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#model_Model.findOneAndUpdate",target:"_blank",rel:"noopener noreferrer"}},[e._v("Model.findOneAndUpdate()"),t("OutboundLink")],1)]),e._v(" "),t("h5",{attrs:{id:"parameters-6"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#parameters-6"}},[e._v("#")]),e._v(" Parameters")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("[conditions] «Object»")])]),e._v(" "),t("li",[t("p",[e._v("[update] «Object»")])]),e._v(" "),t("li",[t("p",[e._v("[options]")]),e._v(" "),t("p",[e._v("«Object»")]),e._v(" "),t("p",[e._v("optional see")]),e._v(" "),t("p",[t("code",[e._v("Query.prototype.setOptions()")])])]),e._v(" "),t("li",[t("ul",[t("li",[t("p",[e._v("[options.returnDocument='before']")]),e._v(" "),t("p",[e._v("«String»")]),e._v(" "),t("p",[e._v("Has two possible values,")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("'before'\n")])])]),t("p",[e._v("and")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("'after'\n")])])]),t("p",[e._v(". By default, it will return the document before the update was applied.")])])])]),e._v(" "),t("li",[t("ul",[t("li",[t("p",[e._v("[options.lean]")]),e._v(" "),t("p",[e._v("«Object»")]),e._v(" "),t("p",[e._v("if truthy, mongoose will return the document as a plain JavaScript object rather than a mongoose document. See")]),e._v(" "),t("p",[t("code",[e._v("Query.lean()")])]),e._v(" "),t("p",[e._v("and")]),e._v(" "),t("p",[e._v("the Mongoose lean tutorial")]),e._v(" "),t("p",[e._v(".")])])])]),e._v(" "),t("li",[t("ul",[t("li",[t("p",[e._v("[options.session=null]")]),e._v(" "),t("p",[e._v("«ClientSession»")]),e._v(" "),t("p",[e._v("The session associated with this query. See")]),e._v(" "),t("p",[e._v("transactions docs")]),e._v(" "),t("p",[e._v(".")])])])]),e._v(" "),t("li",[t("ul",[t("li",[t("p",[e._v("[options.strict]")]),e._v(" "),t("p",[e._v("«Boolean|String»")]),e._v(" "),t("p",[e._v("overwrites the schema's")]),e._v(" "),t("p",[e._v("strict mode option")])])])]),e._v(" "),t("li",[t("ul",[t("li",[t("p",[e._v("[options.timestamps=null]")]),e._v(" "),t("p",[e._v("«Boolean»")]),e._v(" "),t("p",[e._v("If set to")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("false\n")])])]),t("p",[e._v("and")]),e._v(" "),t("p",[e._v("schema-level timestamps")]),e._v(" "),t("p",[e._v("are enabled, skip timestamps for this update. Note that this allows you to overwrite timestamps. Does nothing if schema-level timestamps are not set.")])])])]),e._v(" "),t("li",[t("ul",[t("li",[t("p",[e._v("[options.overwrite=false]")]),e._v(" "),t("p",[e._v("«Boolean»")]),e._v(" "),t("p",[e._v("By default, if you don't include any")]),e._v(" "),t("p",[e._v("update operators")]),e._v(" "),t("p",[e._v("in")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("update\n")])])]),t("p",[e._v(", Mongoose will wrap")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("update\n")])])]),t("p",[e._v("in")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("$set\n")])])]),t("p",[e._v("for you. This prevents you from accidentally overwriting the document. This option tells Mongoose to skip adding")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("$set\n")])])]),t("p",[e._v(". An alternative to this would be using")]),e._v(" "),t("p",[e._v("Model.findOneAndReplace(conditions, update, options, callback)")]),e._v(" "),t("p",[e._v(".")])])])]),e._v(" "),t("li",[t("ul",[t("li",[t("p",[e._v("[options.upsert=false]")]),e._v(" "),t("p",[e._v("«Boolean»")]),e._v(" "),t("p",[e._v("if true, and no documents found, insert a new document")])])])]),e._v(" "),t("li",[t("ul",[t("li",[t("p",[e._v("[options.projection=null]")]),e._v(" "),t("p",[e._v("«Object|String|Array"),t("String",[e._v("»")])],1),e._v(" "),t("p",[e._v("optional fields to return, see")]),e._v(" "),t("p",[t("code",[e._v("Query.prototype.select()")])])])])]),e._v(" "),t("li",[t("p",[e._v("[callback] «Function»")])])]),e._v(" "),t("h5",{attrs:{id:"returns-6"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#returns-6"}},[e._v("#")]),e._v(" Returns:")]),e._v(" "),t("ul",[t("li",[e._v("«Query»")])]),e._v(" "),t("p",[e._v("Issues a mongodb findAndModify update command.")]),e._v(" "),t("p",[e._v("Finds a matching document, updates it according to the "),t("code",[e._v("update")]),e._v(" arg, passing any "),t("code",[e._v("options")]),e._v(", and returns the found document (if any) to the callback. The query executes if "),t("code",[e._v("callback")]),e._v(" is passed else a Query object is returned.")]),e._v(" "),t("p",[e._v("注意，findOneAndUpdate默认返回旧的文档，即查询到的、更新前的文档，")]),e._v(" "),t("p",[e._v("通过options.new为true，可以返回更新后的文档。")]),e._v(" "),t("h4",{attrs:{id:"options-5"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#options-5"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#options",target:"_blank",rel:"noopener noreferrer"}},[e._v("Options:"),t("OutboundLink")],1)]),e._v(" "),t("ul",[t("li",[t("code",[e._v("new")]),e._v(": bool - 如果为true，则返回更新后的文档，否则返回原始文档。默认值为false，在4.0版本变更。（是4.0改为false了还是4.0改为true了？？） defaults to false (changed in 4.0)")]),e._v(" "),t("li",[t("code",[e._v("upsert")]),e._v(": bool - creates the object if it doesn't exist. defaults to false.")]),e._v(" "),t("li",[t("code",[e._v("overwrite")]),e._v(": bool - if true, replace the entire document.")]),e._v(" "),t("li",[t("code",[e._v("fields")]),e._v(": {Object|String} - Field selection. Equivalent to "),t("code",[e._v(".select(fields).findOneAndUpdate()")])]),e._v(" "),t("li",[t("code",[e._v("maxTimeMS")]),e._v(": puts a time limit on the query - requires mongodb >= 2.6.0")]),e._v(" "),t("li",[t("code",[e._v("sort")]),e._v(": if multiple docs are found by the conditions, sets the sort order to choose which doc to update")]),e._v(" "),t("li",[t("code",[e._v("runValidators")]),e._v(": if true, runs "),t("a",{attrs:{href:"https://mongoosejs.com/docs/validation.html#update-validators",target:"_blank",rel:"noopener noreferrer"}},[e._v("update validators"),t("OutboundLink")],1),e._v(" on this command. Update validators validate the update operation against the model's schema.")]),e._v(" "),t("li",[t("code",[e._v("setDefaultsOnInsert")]),e._v(": "),t("code",[e._v("true")]),e._v(" by default. If "),t("code",[e._v("setDefaultsOnInsert")]),e._v(" and "),t("code",[e._v("upsert")]),e._v(" are true, mongoose will apply the "),t("a",{attrs:{href:"https://mongoosejs.com/docs/defaults.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("defaults"),t("OutboundLink")],1),e._v(" specified in the model's schema if a new document is created.")]),e._v(" "),t("li",[t("code",[e._v("rawResult")]),e._v(": if true, returns the "),t("a",{attrs:{href:"https://mongodb.github.io/node-mongodb-native/4.3/interfaces/ModifyResult.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("raw result from the MongoDB driver"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("code",[e._v("strict")]),e._v(": overwrites the schema's "),t("a",{attrs:{href:"https://mongoosejs.com/docs/guide.html#strict",target:"_blank",rel:"noopener noreferrer"}},[e._v("strict mode option"),t("OutboundLink")],1),e._v(" for this update")])]),e._v(" "),t("h4",{attrs:{id:"examples-5"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#examples-5"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#examples",target:"_blank",rel:"noopener noreferrer"}},[e._v("Examples:"),t("OutboundLink")],1)]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("A.findOneAndUpdate(conditions, update, options, callback) // executes\nA.findOneAndUpdate(conditions, update, options)  // returns Query\nA.findOneAndUpdate(conditions, update, callback) // executes\nA.findOneAndUpdate(conditions, update)           // returns Query\nA.findOneAndUpdate()                             // returns Query\n")])])]),t("h4",{attrs:{id:"note-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#note-3"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#note",target:"_blank",rel:"noopener noreferrer"}},[e._v("Note:"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("All top level update keys which are not "),t("code",[e._v("atomic")]),e._v(" operation names are treated as set operations:")]),e._v(" "),t("h4",{attrs:{id:"example-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#example-3"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#example",target:"_blank",rel:"noopener noreferrer"}},[e._v("Example:"),t("OutboundLink")],1)]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("const query = { name: 'borne' };\nModel.findOneAndUpdate(query, { name: 'jason bourne' }, options, callback)\n\n// is sent as\nModel.findOneAndUpdate(query, { $set: { name: 'jason bourne' }}, options, callback)\n")])])]),t("p",[e._v("This helps prevent accidentally overwriting your document with "),t("code",[e._v("{ name: 'jason bourne' }")]),e._v(".")]),e._v(" "),t("h4",{attrs:{id:"note-4"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#note-4"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#note-1",target:"_blank",rel:"noopener noreferrer"}},[e._v("Note:"),t("OutboundLink")],1)]),e._v(" "),t("p",[t("code",[e._v("findOneAndX")]),e._v(" and "),t("code",[e._v("findByIdAndX")]),e._v(" functions support limited validation that you can enable by setting the "),t("code",[e._v("runValidators")]),e._v(" option.")]),e._v(" "),t("p",[e._v("If you need full-fledged validation, use the traditional approach of first retrieving the document.")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("const doc = await Model.findById(id);\ndoc.name = 'jason bourne';\nawait doc.save();\n")])])]),t("p",[e._v("通过Model查询，得到的结果是一个Query。")]),e._v(" "),t("p",[e._v("Model.find()\nParameters：\nconditions «Object»\n[projection] «Object» optional fields to return (http://bit.ly/1HotzBo)\n[options] «Object» optional see Query.prototype.setOptions()\n[callback] «Function»")]),e._v(" "),t("p",[e._v("Returns: «Query»")]),e._v(" "),t("p",[e._v("我们先查询：")]),e._v(" "),t("p",[e._v("model.find()")]),e._v(" "),t("p",[e._v("再做分页查询：")]),e._v(" "),t("p",[e._v("model.find().skip(20).limit(10)")]),e._v(" "),t("p",[e._v("再做个排序：")]),e._v(" "),t("p",[e._v("model.find().skip(20).limit(10).sort({")]),e._v(" "),t("p",[e._v("name: 1")]),e._v(" "),t("p",[e._v("})")]),e._v(" "),t("p",[e._v("说明，skip，limit，sort方法，是Query的原型方法。")]),e._v(" "),t("p",[t("strong",[e._v("Model.find(conditions, [fields], [options], [callback])")])]),e._v(" "),t("p",[e._v("查询就是返回一个"),t("strong",[e._v("集合中的文档的子集")]),e._v("，是一个数组。")]),e._v(" "),t("p",[e._v("数组的每个元素就是一条文档。")]),e._v(" "),t("p",[e._v("conditions "),t("Object",[e._v(" //查询条件")])],1),e._v(" "),t("p",[e._v("[fields] "),t("Object",[e._v(" //要查询的字段")])],1),e._v(" "),t("p",[e._v("[options] "),t("Object",[e._v(" //查询配置参数")])],1),e._v(" "),t("p",[e._v("[callback] "),t("Function",[e._v(" //回调")])],1),e._v(" "),t("p",[e._v("这是18年的叫法。")]),e._v(" "),t("p",[e._v("现在文档改了，分别叫做：")]),e._v(" "),t("p",[e._v("filter\n[projection] optional fields to return, see Query.prototype.select()\n[options] «Object» optional see Query.prototype.setOptions()\n[callback] «Function»")]),e._v(" "),t("p",[e._v("Mongoose Model提供了find，findOne，findBy方法用于文档查询。")]),e._v(" "),t("p",[e._v("Model.find()\nModel.findById()\nModel.findByIdAndDelete()\nModel.findByIdAndRemove()\nModel.findByIdAndUpdate()\nModel.findOne()\nModel.findOneAndDelete()\nModel.findOneAndRemove()\nModel.findOneAndReplace()\nModel.findOneAndUpdate()")]),e._v(" "),t("h3",{attrs:{id:"filter"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#filter"}},[e._v("#")]),e._v(" filter")]),e._v(" "),t("p",[e._v("«Object|ObjectId»")]),e._v(" "),t("p",[e._v("查询条件。是一个对象或者ObjectId。")]),e._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[e._v("userModel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("find")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'Lee'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n\nuserModel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("find")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'Lee'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("age")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("18")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n\n\nuserModel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("find")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("age")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("$gt")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("18")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("$lt")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("30")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n\n\nuserModel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("find")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'Lee'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("age")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("18")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("26")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("28")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),t("h3",{attrs:{id:"范围查询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#范围查询"}},[e._v("#")]),e._v(" 范围查询")]),e._v(" "),t("p",[e._v("$or　　　　或关系")]),e._v(" "),t("p",[e._v("$nor　　　 或关系取反")]),e._v(" "),t("p",[e._v("$gt　　　　大于")]),e._v(" "),t("p",[e._v("$gte　　　 大于等于")]),e._v(" "),t("p",[e._v("$lt　　　　 小于")]),e._v(" "),t("p",[e._v("$lte　　　  小于等于")]),e._v(" "),t("p",[e._v("$ne       不等于")]),e._v(" "),t("p",[e._v("$in       在"),t("strong",[e._v("多个值")]),e._v("范围内（只有一个值时就直接用 {age:10}）")]),e._v(" "),t("p",[e._v("$nin      不在多个值范围内")]),e._v(" "),t("p",[e._v("$all       匹配数组中多个值")]),e._v(" "),t("p"),e._v(" "),t("p",[e._v("$size　　　匹配数组大小")]),e._v(" "),t("p",[e._v("$maxDistance　　范围查询，距离（基于LBS）")]),e._v(" "),t("p",[e._v("$mod　　  取模运算")]),e._v(" "),t("p",[e._v("$near　　　邻域查询，查询附近的位置（基于LBS）")]),e._v(" "),t("p",[e._v("$exists　　  字段是否存在")]),e._v(" "),t("p",[e._v("$elemMatch　　匹配内数组内的元素")]),e._v(" "),t("p",[e._v("$within　　范围查询（基于LBS）")]),e._v(" "),t("p",[e._v("$box　　　 范围查询，矩形范围（基于LBS）")]),e._v(" "),t("p",[e._v("$center    范围醒询，圆形范围（基于LBS）")]),e._v(" "),t("p",[e._v("$centerSphere　　范围查询，球形范围（基于LBS）")]),e._v(" "),t("p",[e._v("$slice　　　　查询字段集合中的元素（比如从第几个之后，第N到第M个元素）")]),e._v(" "),t("p",[t("em",[e._v("User.find({userage: {$gte: 21, $lte: 65}}, callback);")])]),e._v(" "),t("p",[e._v("//这表示查询年龄大于等21而且小于等于65岁")]),e._v(" "),t("p",[e._v("查询所有等于6或者7岁或者8的小朋友")]),e._v(" "),t("p",[e._v("model.find({age:{$in:[6,7,8]}},function(err,result));")]),e._v(" "),t("p",[e._v("$in 和 $ne 除了条件判断不同，用法很相似。")]),e._v(" "),t("h3",{attrs:{id:"projection-投射"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#projection-投射"}},[e._v("#")]),e._v(" projection 投射")]),e._v(" "),t("p",[e._v("参数： «对象|字符串|数组<字符串>»")]),e._v(" "),t("p",[e._v("«Object|String|Array"),t("String",[e._v("»")])],1),e._v(" "),t("p",[e._v("optional fields to return, see "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/query.html#query_Query-select",target:"_blank",rel:"noopener noreferrer"}},[e._v("Query.prototype.select()"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("几个demo：")]),e._v(" "),t("p",[e._v("find（conditons，projection ，callback）")]),e._v(" "),t("p",[e._v("projection 省略或者为null，查询所有字段。")]),e._v(" "),t("p",[e._v("Model.find({},{name:1,age:1,_id:0},function(err,result))")]),e._v(" "),t("p",[e._v("返回只包含name,age两个字段的所有记录。")]),e._v(" "),t("p",[e._v("1表示查询输出该字段，0表示不输出。")]),e._v(" "),t("p",[e._v("默认都会显示 _id，设置为0可以不显示。")]),e._v(" "),t("p",[e._v("其他非_id的字段，若设置为0会报错。")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://mongoosejs.com/docs/api/query.html#query_Query-select",target:"_blank",rel:"noopener noreferrer"}},[e._v("Query.prototype.select()"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("指定"),t("strong",[e._v("要包含或排除的文档字段")]),e._v("（也称为查询“"),t("strong",[e._v("投影")]),e._v("”）")]),e._v(" "),t("p",[e._v("使用字符串语法时，为路径添加前缀"),t("code",[e._v("-")]),e._v("会将该路径标记为已排除。")]),e._v(" "),t("p",[e._v("当路径没有"),t("code",[e._v("-")]),e._v("前缀时，它被包括在内。")]),e._v(" "),t("p",[e._v("最后，如果路径以 为前缀"),t("code",[e._v("+")]),e._v("，它会强制包含该路径，这对于在"),t("a",{attrs:{href:"https://mongoosejs.com/docs/api.html#schematype_SchemaType-select",target:"_blank",rel:"noopener noreferrer"}},[e._v("架构级别"),t("OutboundLink")],1),e._v("排除的路径很有用。")]),e._v(" "),t("p",[e._v("投影"),t("em",[e._v("必须")]),e._v("是"),t("strong",[e._v("包含性的或排除性")]),e._v("的。")]),e._v(" "),t("p",[e._v("换句话说，您必须要么列出要包含的字段（排除所有其他字段），要么列出要排除的字段（这意味着包含所有其他字段）。该"),t("a",{attrs:{href:"https://docs.mongodb.com/manual/tutorial/project-fields-from-query-results/#suppress-id-field",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("_id")]),e._v("字段是唯一的例外，因为 MongoDB 默认包含它"),t("OutboundLink")],1),e._v("。")]),e._v(" "),t("h4",{attrs:{id:"例子"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#例子"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/query.html#example",target:"_blank",rel:"noopener noreferrer"}},[e._v("例子"),t("OutboundLink")],1)]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("// 只查询a和b字段，其他字段被排除\nquery.select('a b');\n\n// 等同于下面的语法\nquery.select(['a', 'b']);\nquery.select({ a: 1, b: 1 });\n\n// 排除c和d字段，只查询其他字段\nquery.select('-c -d');\n\n// Use `+` to override schema-level `select: false` without making the\n// projection inclusive.\nconst schema = new Schema({\n  foo: { type: String, select: false },\n  bar: String\n});\n\n// ...\nquery.select('+foo'); // Override foo's `select: false` without excluding `bar`\n\n// or you may use object notation, useful when\n// you have keys already prefixed with a \"-\"\nquery.select({ a: 1, b: 1 });\nquery.select({ c: 0, d: 0 });\n\nAdditional calls to select can override the previous selection:\nquery.select({ a: 1, b: 1 }).select({ b: 0 }); // selection is now { a: 1 }\nquery.select({ a: 0, b: 0 }).select({ b: 1 }); // selection is now { a: 0 }\n")])])]),t("h3",{attrs:{id:"options-6"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#options-6"}},[e._v("#")]),e._v(" options")]),e._v(" "),t("p",[e._v("«Object»")]),e._v(" "),t("p",[e._v("optional see "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/query.html#query_Query-setOptions",target:"_blank",rel:"noopener noreferrer"}},[e._v("Query.prototype.setOptions()"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("Query.prototype.setOptions()")]),e._v(" "),t("h5",{attrs:{id:"parameters-7"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#parameters-7"}},[e._v("#")]),e._v(" Parameters")]),e._v(" "),t("ul",[t("li",[e._v("options «Object»")])]),e._v(" "),t("h5",{attrs:{id:"returns-7"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#returns-7"}},[e._v("#")]),e._v(" Returns:")]),e._v(" "),t("ul",[t("li",[e._v("«Query» this")])]),e._v(" "),t("p",[e._v("Sets query options. Some options only make sense for certain operations.")]),e._v(" "),t("h4",{attrs:{id:"options-7"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#options-7"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/query.html#options",target:"_blank",rel:"noopener noreferrer"}},[e._v("Options:"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("The following options are only for "),t("code",[e._v("find()")]),e._v(":")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://www.mongodb.org/display/DOCS/Tailable+Cursors",target:"_blank",rel:"noopener noreferrer"}},[e._v("tailable"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://www.mongodb.org/display/DOCS/Advanced+Queries#AdvancedQueries-%7B%7Bsort()%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[e._v("sort"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://www.mongodb.org/display/DOCS/Advanced+Queries#AdvancedQueries-%7B%7Blimit()%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[e._v("limit"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://www.mongodb.org/display/DOCS/Advanced+Queries#AdvancedQueries-%7B%7Bskip()%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[e._v("skip"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.mongodb.com/manual/reference/method/cursor.allowDiskUse/",target:"_blank",rel:"noopener noreferrer"}},[e._v("allowDiskUse"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://www.mongodb.org/display/DOCS/Advanced+Queries#AdvancedQueries-%7B%7BbatchSize()%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[e._v("batchSize"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.mongodb.org/manual/applications/replication/#read-preference",target:"_blank",rel:"noopener noreferrer"}},[e._v("readPreference"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://www.mongodb.org/display/DOCS/Advanced+Queries#AdvancedQueries-%24hint",target:"_blank",rel:"noopener noreferrer"}},[e._v("hint"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://www.mongodb.org/display/DOCS/Advanced+Queries#AdvancedQueries-%24comment",target:"_blank",rel:"noopener noreferrer"}},[e._v("comment"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://www.mongodb.org/display/DOCS/Advanced+Queries#AdvancedQueries-%7B%7Bsnapshot()%7D%7D",target:"_blank",rel:"noopener noreferrer"}},[e._v("snapshot"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.mongodb.org/v3.2/reference/operator/meta/maxScan/#metaOp._S_maxScan",target:"_blank",rel:"noopener noreferrer"}},[e._v("maxscan"),t("OutboundLink")],1)])]),e._v(" "),t("p",[e._v("The following options are only for write operations: "),t("code",[e._v("update()")]),e._v(", "),t("code",[e._v("updateOne()")]),e._v(", "),t("code",[e._v("updateMany()")]),e._v(", "),t("code",[e._v("replaceOne()")]),e._v(", "),t("code",[e._v("findOneAndUpdate()")]),e._v(", and "),t("code",[e._v("findByIdAndUpdate()")]),e._v(":")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://docs.mongodb.com/manual/reference/method/db.collection.update/",target:"_blank",rel:"noopener noreferrer"}},[e._v("upsert"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.mongodb.com/manual/reference/method/db.collection.update/",target:"_blank",rel:"noopener noreferrer"}},[e._v("writeConcern"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://mongoosejs.com/docs/guide.html#timestamps",target:"_blank",rel:"noopener noreferrer"}},[e._v("timestamps"),t("OutboundLink")],1),e._v(": If "),t("code",[e._v("timestamps")]),e._v(" is set in the schema, set this option to "),t("code",[e._v("false")]),e._v(" to skip timestamps for that particular update. Has no effect if "),t("code",[e._v("timestamps")]),e._v(" is not enabled in the schema options.")]),e._v(" "),t("li",[e._v("overwriteDiscriminatorKey: allow setting the discriminator key in the update. Will use the correct discriminator schema if the update changes the discriminator key.")])]),e._v(" "),t("p",[e._v("The following options are only for "),t("code",[e._v("find()")]),e._v(", "),t("code",[e._v("findOne()")]),e._v(", "),t("code",[e._v("findById()")]),e._v(", "),t("code",[e._v("findOneAndUpdate()")]),e._v(", and "),t("code",[e._v("findByIdAndUpdate()")]),e._v(":")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://mongoosejs.com/docs/api/api.html#query_Query-lean",target:"_blank",rel:"noopener noreferrer"}},[e._v("lean"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://mongoosejs.com/docs/populate.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("populate"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://mongoosejs.com/docs/api/query.html#query_Query-projection",target:"_blank",rel:"noopener noreferrer"}},[e._v("projection"),t("OutboundLink")],1)]),e._v(" "),t("li",[e._v("sanitizeProjection")])]),e._v(" "),t("p",[e._v("The following options are only for all operations "),t("strong",[e._v("except")]),e._v(" "),t("code",[e._v("update()")]),e._v(", "),t("code",[e._v("updateOne()")]),e._v(", "),t("code",[e._v("updateMany()")]),e._v(", "),t("code",[e._v("remove()")]),e._v(", "),t("code",[e._v("deleteOne()")]),e._v(", and "),t("code",[e._v("deleteMany()")]),e._v(":")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://docs.mongodb.com/manual/reference/operator/meta/maxTimeMS/",target:"_blank",rel:"noopener noreferrer"}},[e._v("maxTimeMS"),t("OutboundLink")],1)])]),e._v(" "),t("p",[e._v("The following options are for "),t("code",[e._v("findOneAndUpdate()")]),e._v(" and "),t("code",[e._v("findOneAndRemove()")])]),e._v(" "),t("ul",[t("li",[e._v("rawResult")])]),e._v(" "),t("h2",{attrs:{id:"the-following-options-are-for-all-operations"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#the-following-options-are-for-all-operations"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/query.html#the-following-options-are-for-all-operations",target:"_blank",rel:"noopener noreferrer"}},[e._v("The following options are for all operations"),t("OutboundLink")],1)]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://mongoosejs.com/docs/guide.html#strict",target:"_blank",rel:"noopener noreferrer"}},[e._v("strict"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.mongodb.com/manual/reference/collation/",target:"_blank",rel:"noopener noreferrer"}},[e._v("collation"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.mongodb.com/manual/reference/server-sessions/",target:"_blank",rel:"noopener noreferrer"}},[e._v("session"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.mongodb.com/manual/reference/method/cursor.explain/",target:"_blank",rel:"noopener noreferrer"}},[e._v("explain"),t("OutboundLink")],1)])]),e._v(" "),t("h3",{attrs:{id:"callback"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#callback"}},[e._v("#")]),e._v(" callback")]),e._v(" "),t("p",[e._v("«Function»")]),e._v(" "),t("h4",{attrs:{id:"examples-6"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#examples-6"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#examples",target:"_blank",rel:"noopener noreferrer"}},[e._v("Examples:"),t("OutboundLink")],1)]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("// 查询所有文档\nawait MyModel.find({});\n\n// find all documents named john and at least 18\nawait MyModel.find({ name: 'john', age: { $gte: 18 } }).exec();\n\n// executes, passing results to callback\nMyModel.find({ name: 'john', age: { $gte: 18 }}, function (err, docs) {});\n\n// executes, name LIKE john and only selecting the \"name\" and \"friends\" fields\nawait MyModel.find({ name: /john/i }, 'name friends').exec();\n\n// passing options\nawait MyModel.find({ name: /john/i }, null, { skip: 10 }).exec();\n")])])]),t("p",[e._v("聚合查询")]),e._v(" "),t("p",[e._v("联表查询 连表查询")]),e._v(" "),t("h3",{attrs:{id:"数量查询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数量查询"}},[e._v("#")]),e._v(" 数量查询")]),e._v(" "),t("p",[e._v("替换"),t("code",[e._v("count()")]),e._v("为"),t("code",[e._v("countDocuments()")]),e._v("，")]),e._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("count")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("filter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("countDocuments")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("filter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),t("h3",{attrs:{id:"populate关联查询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#populate关联查询"}},[e._v("#")]),e._v(" populate关联查询")]),e._v(" "),t("p",[e._v("populate")]),e._v(" "),t("p",[e._v("用于查看关联文档内容, 也就是查询 "),t("strong",[e._v("设置了")]),e._v(" "),t("code",[e._v("**ref**")]),e._v(" "),t("strong",[e._v("的字段")]),e._v(" 关联的 文档的 相关字段")]),e._v(" "),t("p",[e._v("Model.*"),t("strong",[e._v("populate*")]),e._v("(docs, options, [cb(err,doc)])")]),e._v(" "),t("p",[e._v("例子：")]),e._v(" "),t("p",[e._v("// User")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("const userSchema = new mongoose.Schema({\n    username:{type:String,required:true},\n    password:{type:String,required:true},\n    email:{type:String,required:true},\n  });\n \n")])])]),t("p",[e._v("// Articel")]),e._v(" "),t("p",[e._v("const "),t("em",[e._v("ObjectId")]),e._v(" = "),t("em",[e._v("mongoose")]),e._v(".Schema.Types.ObjectId;\nconst "),t("em",[e._v("articleSchema")]),e._v(" = new "),t("em",[e._v("mongoose")]),e._v(".Schema({\ntitle:{type:String,required:true},\ncontent:{type:String,required:true},\ncreate_on:{type:Date,default:Date.now},\nuser:{type:"),t("em",[e._v("ObjectId")]),e._v(",ref:'User'}\n});")]),e._v(" "),t("p",[e._v("以上，Article集合的user字段，类型为ObjectId，通过存放User集合中记录的_id字段的值，就关联了User集合。就可以使用populate关联查询到User集合中的数据。")]),e._v(" "),t("p",[e._v("//示例")]),e._v(" "),t("p",[t("em",[e._v("Article")]),e._v(".find({}).populate('user').exec(function("),t("em",[e._v("err")]),e._v(","),t("em",[e._v("result")]),e._v("){\nconsole.log("),t("em",[e._v("result")]),e._v("[0].user); // 此时user成为了一个对象，对应User集合中的一条记录\nconsole.log("),t("em",[e._v("result")]),e._v("[0].user.username);\nconsole.log("),t("em",[e._v("result")]),e._v("[0].user.password);")]),e._v(" "),t("p",[e._v("});")]),e._v(" "),t("p",[e._v("//多个关联表需要使用数组")]),e._v(" "),t("p",[e._v("yield Article.findOne({")]),e._v(" "),t("p",[e._v("​    _id: id")]),e._v(" "),t("p",[e._v("}, {")]),e._v(" "),t("p",[e._v("​    title: 1,")]),e._v(" "),t("p",[e._v("​    author: 1")]),e._v(" "),t("p",[e._v("})")]),e._v(" "),t("p",[e._v(".populate([{")]),e._v(" "),t("p",[e._v("​    path: 'comments', //文章的comments字段")]),e._v(" "),t("p",[e._v("​    select: {")]),e._v(" "),t("p",[e._v("​      _id: 1,")]),e._v(" "),t("p",[e._v("​      user: 1,")]),e._v(" "),t("p",[e._v("​      text: 1,")]),e._v(" "),t("p",[e._v("​    },")]),e._v(" "),t("p",[e._v("}, {")]),e._v(" "),t("p",[e._v("​    path: 'category' //文章的category字段,")]),e._v(" "),t("p",[e._v("​    select: {")]),e._v(" "),t("p",[e._v("​      fields...")]),e._v(" "),t("p",[e._v("​    }")]),e._v(" "),t("p",[e._v("}])")]),e._v(" "),t("h2",{attrs:{id:"创建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建"}},[e._v("#")]),e._v(" 创建")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#model_Model.create",target:"_blank",rel:"noopener noreferrer"}},[e._v("Model.create()"),t("OutboundLink")],1)])]),e._v(" "),t("h3",{attrs:{id:"model-create"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#model-create"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#model_Model.create",target:"_blank",rel:"noopener noreferrer"}},[e._v("Model.create()"),t("OutboundLink")],1)]),e._v(" "),t("h5",{attrs:{id:"parameters-8"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#parameters-8"}},[e._v("#")]),e._v(" Parameters")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("docs")]),e._v(" "),t("p",[e._v("«Array|Object»")]),e._v(" "),t("p",[e._v("Documents to insert, as a spread or array")])]),e._v(" "),t("li",[t("p",[e._v("[options]")]),e._v(" "),t("p",[e._v("«Object»")]),e._v(" "),t("p",[e._v("Options passed down tosave(). To specify options, docs must be an array, not a spread.")])]),e._v(" "),t("li",[t("p",[e._v("[callback]")]),e._v(" "),t("p",[e._v("«Function»")]),e._v(" "),t("p",[e._v("callback")])])]),e._v(" "),t("h5",{attrs:{id:"returns-8"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#returns-8"}},[e._v("#")]),e._v(" Returns:")]),e._v(" "),t("ul",[t("li",[e._v("«Promise»")])]),e._v(" "),t("p",[e._v("Shortcut for saving one or more documents to the database. "),t("code",[e._v("MyModel.create(docs)")]),e._v(" does "),t("code",[e._v("new MyModel(doc).save()")]),e._v(" for every doc in docs.")]),e._v(" "),t("p",[e._v("将一个或多个文档保存到数据库的快捷方式。 "),t("code",[e._v("MyModel.create(docs)")]),e._v("为文档中"),t("code",[e._v("new MyModel(doc).save()")]),e._v("的每个文档做。")]),e._v(" "),t("p",[e._v("此函数触发以下中间件。")]),e._v(" "),t("p",[e._v("This function triggers the following middleware.")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("save()")])])]),e._v(" "),t("h4",{attrs:{id:"example-4"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#example-4"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#example",target:"_blank",rel:"noopener noreferrer"}},[e._v("Example:"),t("OutboundLink")],1)]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("// Insert one new `Character` document\nawait Character.create({ name: 'Jean-Luc Picard' });\n\n// Insert multiple new `Character` documents\nawait Character.create([{ name: 'Will Riker' }, { name: 'Geordi LaForge' }]);\n\n// Create a new character within a transaction. Note that you **must**\n// pass an array as the first parameter to `create()` if you want to\n// specify options.\nawait Character.create([{ name: 'Jean-Luc Picard' }], { session });\n")])])]),t("h2",{attrs:{id:"更新"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#更新"}},[e._v("#")]),e._v(" 更新")]),e._v(" "),t("p",[e._v("语法：")]),e._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 使用doc更新匹配到的第一个文档。已弃用。")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("update")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("filter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" doc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" options"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 推荐使用")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 使用doc更新匹配到的所有文档。不管multi选项的值如何。")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// updateMany不会触发更新中间件。使用pre('updateMany') andpost('updateMany')代替。")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("updateMany")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("filter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" doc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" options"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 使用doc更新匹配到的第一个文档。")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 不支持multi和overwrite选项。")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 好像会触发更新中间件。")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("updateOne")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("filter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" doc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" options"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("replaceOne")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),t("ul",[t("li",[t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#model_Model.update",target:"_blank",rel:"noopener noreferrer"}},[e._v("Model.update()"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#model_Model.updateMany",target:"_blank",rel:"noopener noreferrer"}},[e._v("Model.updateMany()"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#model_Model.updateOne",target:"_blank",rel:"noopener noreferrer"}},[e._v("Model.updateOne()"),t("OutboundLink")],1)])]),e._v(" "),t("h2",{attrs:{id:"删除"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除"}},[e._v("#")]),e._v(" 删除")]),e._v(" "),t("p",[e._v("替换"),t("code",[e._v("remove()")]),e._v("为"),t("code",[e._v("deleteOne()")]),e._v("或"),t("code",[e._v("deleteMany()")]),e._v("。")]),e._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 删除符合查询条件的所有文档。若只删除一个，设置options.single为true。")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 已弃用。")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("remove")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("filter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" options"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 删除符合查询条件的第一个文档。返回一个对象，包含一个deleteCount属性，表示删除的文档数量。")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("deleteOne")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 删除符合查询条件的所有文档，返回一个对象，包含一个deleteCount属性，表示删除的文档数量。")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("deleteMany")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),t("ul",[t("li",[t("p",[t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#model_Model.deleteMany",target:"_blank",rel:"noopener noreferrer"}},[e._v("Model.deleteMany()"),t("OutboundLink")],1)])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#model_Model.deleteOne",target:"_blank",rel:"noopener noreferrer"}},[e._v("Model.deleteOne()"),t("OutboundLink")],1)])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#model_Model.remove",target:"_blank",rel:"noopener noreferrer"}},[e._v("Model.remove()"),t("OutboundLink")],1)])])]),e._v(" "),t("h3",{attrs:{id:"model-deletemany"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#model-deletemany"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#model_Model.deleteMany",target:"_blank",rel:"noopener noreferrer"}},[e._v("Model.deleteMany()"),t("OutboundLink")],1)]),e._v(" "),t("h5",{attrs:{id:"parameters-9"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#parameters-9"}},[e._v("#")]),e._v(" Parameters")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("conditions «Object»")])]),e._v(" "),t("li",[t("p",[e._v("[options]")]),e._v(" "),t("p",[e._v("«Object»")]),e._v(" "),t("p",[e._v("optional see")]),e._v(" "),t("p",[t("code",[e._v("Query.prototype.setOptions()")])])]),e._v(" "),t("li",[t("p",[e._v("[callback] «Function»")])])]),e._v(" "),t("h5",{attrs:{id:"returns-9"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#returns-9"}},[e._v("#")]),e._v(" Returns:")]),e._v(" "),t("ul",[t("li",[e._v("«Query»")])]),e._v(" "),t("p",[e._v("Deletes all of the documents that match "),t("code",[e._v("conditions")]),e._v(" from the collection. It returns an object with the property "),t("code",[e._v("deletedCount")]),e._v(" containing the number of documents deleted. Behaves like "),t("code",[e._v("remove()")]),e._v(", but deletes all documents that match "),t("code",[e._v("conditions")]),e._v(" regardless of the "),t("code",[e._v("single")]),e._v(" option.")]),e._v(" "),t("h4",{attrs:{id:"example-5"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#example-5"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#example",target:"_blank",rel:"noopener noreferrer"}},[e._v("Example:"),t("OutboundLink")],1)]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("await Character.deleteMany({ name: /Stark/, age: { $gte: 18 } }); // returns {deletedCount: x} where x is the number of documents deleted.\n")])])]),t("h4",{attrs:{id:"note-5"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#note-5"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#note",target:"_blank",rel:"noopener noreferrer"}},[e._v("Note:"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("This function triggers "),t("code",[e._v("deleteMany")]),e._v(" query hooks. Read the "),t("a",{attrs:{href:"https://mongoosejs.com/docs/middleware.html#naming",target:"_blank",rel:"noopener noreferrer"}},[e._v("middleware docs"),t("OutboundLink")],1),e._v(" to learn more.")]),e._v(" "),t("hr"),e._v(" "),t("h3",{attrs:{id:"model-deleteone"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#model-deleteone"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#model_Model.deleteOne",target:"_blank",rel:"noopener noreferrer"}},[e._v("Model.deleteOne()"),t("OutboundLink")],1)]),e._v(" "),t("h5",{attrs:{id:"parameters-10"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#parameters-10"}},[e._v("#")]),e._v(" Parameters")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("conditions «Object»")])]),e._v(" "),t("li",[t("p",[e._v("[options]")]),e._v(" "),t("p",[e._v("«Object»")]),e._v(" "),t("p",[e._v("optional see")]),e._v(" "),t("p",[t("code",[e._v("Query.prototype.setOptions()")])])]),e._v(" "),t("li",[t("p",[e._v("[callback] «Function»")])])]),e._v(" "),t("h5",{attrs:{id:"returns-10"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#returns-10"}},[e._v("#")]),e._v(" Returns:")]),e._v(" "),t("ul",[t("li",[e._v("«Query»")])]),e._v(" "),t("p",[e._v("Deletes the first document that matches "),t("code",[e._v("conditions")]),e._v(" from the collection. It returns an object with the property "),t("code",[e._v("deletedCount")]),e._v(" indicating how many documents were deleted. Behaves like "),t("code",[e._v("remove()")]),e._v(", but deletes at most one document regardless of the "),t("code",[e._v("single")]),e._v(" option.")]),e._v(" "),t("h4",{attrs:{id:"example-6"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#example-6"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#example",target:"_blank",rel:"noopener noreferrer"}},[e._v("Example:"),t("OutboundLink")],1)]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("await Character.deleteOne({ name: 'Eddard Stark' }); // returns {deletedCount: 1}\n")])])]),t("h4",{attrs:{id:"note-6"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#note-6"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/model.html#note",target:"_blank",rel:"noopener noreferrer"}},[e._v("Note:"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("This function triggers "),t("code",[e._v("deleteOne")]),e._v(" query hooks. Read the "),t("a",{attrs:{href:"https://mongoosejs.com/docs/middleware.html#naming",target:"_blank",rel:"noopener noreferrer"}},[e._v("middleware docs"),t("OutboundLink")],1),e._v(" to learn more.")]),e._v(" "),t("h2",{attrs:{id:"分页"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#分页"}},[e._v("#")]),e._v(" 分页")]),e._v(" "),t("p",[e._v("分页查询，需要用到两个api，skip和limit。")]),e._v(" "),t("h3",{attrs:{id:"query-prototype-limit"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#query-prototype-limit"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/query.html#query_Query-limit",target:"_blank",rel:"noopener noreferrer"}},[e._v("Query.prototype.limit()"),t("OutboundLink")],1)]),e._v(" "),t("h5",{attrs:{id:"parameters-11"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#parameters-11"}},[e._v("#")]),e._v(" Parameters")]),e._v(" "),t("ul",[t("li",[e._v("val «Number»")])]),e._v(" "),t("p",[e._v("指定查询返回的最大文档数目。即限制查询的条数。")]),e._v(" "),t("p",[e._v("Specifies the maximum number of documents the query will return.")]),e._v(" "),t("h4",{attrs:{id:"example-7"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#example-7"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/query.html#example",target:"_blank",rel:"noopener noreferrer"}},[e._v("Example"),t("OutboundLink")],1)]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("query.limit(20);\n")])])]),t("h4",{attrs:{id:"note-7"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#note-7"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/query.html#note",target:"_blank",rel:"noopener noreferrer"}},[e._v("Note"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("Cannot be used with "),t("code",[e._v("distinct()")])]),e._v(" "),t("h3",{attrs:{id:"query-prototype-skip"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#query-prototype-skip"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/query.html#query_Query-skip",target:"_blank",rel:"noopener noreferrer"}},[e._v("Query.prototype.skip()"),t("OutboundLink")],1)]),e._v(" "),t("h5",{attrs:{id:"parameters-12"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#parameters-12"}},[e._v("#")]),e._v(" Parameters")]),e._v(" "),t("ul",[t("li",[e._v("val «Number»")])]),e._v(" "),t("p",[e._v("指定略过的文档数目。即略过一定的条数，再进行查询。")]),e._v(" "),t("p",[e._v("Specifies the number of documents to skip.")]),e._v(" "),t("h4",{attrs:{id:"example-8"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#example-8"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/query.html#example",target:"_blank",rel:"noopener noreferrer"}},[e._v("Example"),t("OutboundLink")],1)]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("query.skip(100).limit(20);\n")])])]),t("h4",{attrs:{id:"note-8"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#note-8"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/query.html#note",target:"_blank",rel:"noopener noreferrer"}},[e._v("Note"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("Cannot be used with "),t("code",[e._v("distinct()")])]),e._v(" "),t("h2",{attrs:{id:"排序"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#排序"}},[e._v("#")]),e._v(" 排序")]),e._v(" "),t("p",[e._v("asc：升序")]),e._v(" "),t("p",[e._v("desc：降序")]),e._v(" "),t("p",[e._v("ascending：")]),e._v(" "),t("p",[e._v("descending：")]),e._v(" "),t("h3",{attrs:{id:"query-prototype-sort"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#query-prototype-sort"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/query.html#query_Query-sort",target:"_blank",rel:"noopener noreferrer"}},[e._v("Query.prototype.sort()"),t("OutboundLink")],1)]),e._v(" "),t("h5",{attrs:{id:"parameters-13"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#parameters-13"}},[e._v("#")]),e._v(" Parameters")]),e._v(" "),t("ul",[t("li",[e._v("arg «Object|String»")])]),e._v(" "),t("h5",{attrs:{id:"returns-11"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#returns-11"}},[e._v("#")]),e._v(" Returns:")]),e._v(" "),t("ul",[t("li",[e._v("«Query» this")])]),e._v(" "),t("p",[e._v("Sets the sort order")]),e._v(" "),t("p",[e._v("如果传递的参数是一个对象，值可以设为 "),t("code",[e._v("asc")]),e._v(", "),t("code",[e._v("desc")]),e._v(", "),t("code",[e._v("ascending")]),e._v(", "),t("code",[e._v("descending")]),e._v(", "),t("code",[e._v("1")]),e._v(", and "),t("code",[e._v("-1")]),e._v("。")]),e._v(" "),t("p",[e._v("If an object is passed, values allowed are "),t("code",[e._v("asc")]),e._v(", "),t("code",[e._v("desc")]),e._v(", "),t("code",[e._v("ascending")]),e._v(", "),t("code",[e._v("descending")]),e._v(", "),t("code",[e._v("1")]),e._v(", and "),t("code",[e._v("-1")]),e._v(".")]),e._v(" "),t("p",[e._v("如果传递的参数是一个字符串，")]),e._v(" "),t("p",[e._v("If a string is passed, it must be a space delimited list of path names. The sort order of each path is ascending unless the path name is prefixed with "),t("code",[e._v("-")]),e._v(" which will be treated as descending.")]),e._v(" "),t("h4",{attrs:{id:"example-9"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#example-9"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/query.html#example",target:"_blank",rel:"noopener noreferrer"}},[e._v("Example"),t("OutboundLink")],1)]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("// sort by \"field\" ascending and \"test\" descending\nquery.sort({ field: 'asc', test: -1 });\n\n// equivalent\nquery.sort('field -test');\n")])])]),t("h4",{attrs:{id:"note-9"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#note-9"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mongoosejs.com/docs/api/query.html#note",target:"_blank",rel:"noopener noreferrer"}},[e._v("Note"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("Cannot be used with "),t("code",[e._v("distinct()")])])])}),[],!1,null,null,null);t.default=n.exports}}]);